<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>dcAncestralML @ dcGOR 1.0.4</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">


<style type="text/css">

.navbar .brand {
  display: block;
  float: left;
  padding: 8px 20px 12px;
  margin-left: -20px;
  font-size: 20px;
  font-weight: 200;
  line-height: 1;
  color: #999999;
}

.navbar .brand:hover {
  color: #F87217;
  text-decoration: none;
  background-color: transparent;
}

.navbar .nav > li > a:hover {
  color: #F87217;
  text-decoration: underline;
  background-color: transparent;
}

</style>


<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- google analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17338744-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- Enlarge image -->
<script type="text/javascript">
    function newWin(url, name, width, height) { 
       
        var left = (screen.width/2)-(width/2);
        var top = (screen.height/2)-(height/2); 
        
        window.open(url,name,'scrollbars=yes,resizable=yes,fullscreen=yes, width=' + width + ', height='+height+', top='+top+', left='+left);
    }
</script>
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="index.html">dcGOR 1.0.4</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html"><i class="icon-home icon-white"></i> Home</a></li>
        </ul>
        <ul class="nav">
          <li><a href="install.html"><i class="icon-wrench icon-white"></i> Installation</a></li>
        </ul>
        <ul class="nav">
          <li><a href="docs.html"><i class="icon-book icon-white"></i> Documentations</a></li>
        </ul>
        <ul class="nav">
          <li><a href="demos.html"><i class="icon-play icon-white"></i> Demos</a></li>
        </ul>
        <ul class="nav">
          <li><a href="cite.html"><i class="icon-pencil icon-white"></i> Citation</a></li>
        </ul>
       
        <!-- HTML for GOOLE SEARCH BAR 
        <ul class="nav">
            <div id="search-wrapper">
                <form id="search" method="get" action="http://www.google.com/custom">
                    <div class="search-box">
                        <i class="icon-search icon-white"></i>
                        <input type="text" id="tfq" class="textinput" name="q" size="21" maxlength="120" value="Google Search"/>
                    </div>
                </form>
            </div>
        </ul>
        -->
        
      </div>
    </div>
  </div>
</div>

<!-- CSS styles for standard search box with placeholder text-->
<style type="text/css">
    #search-wrapper {
        width:300px;
        height:40px;
        background-color:transparent;
        margin:0px auto 0;
        border:0px solid #ff0000;
        -moz-border-radius: 2px; /* FF1+ */
        -webkit-border-radius: 2px; /* Saf3-4 */
        border-radius: 2px; /* Opera 10.5, IE 9, Saf5, Chrome */
        position:relative;
    }

    #search {
        background-color:transparent;
        padding:0px;
        height:40px;
        overflow:hidden;
    }

    .search-box {
        width:250px;
        height:32px;
        background-color:transparent;
        margin:2px 7px;
        border:0px solid #cfcfcf;
        -moz-border-radius: 2px; /* FF1+ */
        -webkit-border-radius: 2px; /* Saf3-4 */
        border-radius: 2px; /* Opera 10.5, IE 9, Saf5, Chrome */
        position:relative;
    }

	.textinput{
		margin: 0;
		padding: 5px 15px;
		font-family: Arial, Helvetica, sans-serif;
		font-size:14px;
		color:#999999;
		border:1px solid #f00; border-right:0px;
		border-top-left-radius: 5px 5px;
		border-bottom-left-radius: 5px 5px;
	}
</style>

<!-- JAVASCRIPT to clear search text when the field is clicked -->
<script type="text/javascript">
window.onload = function(){
	//Get submit button
	var submitbutton = document.getElementById("tfq");
	//Add listener to submit button
	if(submitbutton.addEventListener){
		submitbutton.addEventListener("click", function() {
			if (submitbutton.value == 'Google Search'){//Customize this text string to whatever you want
				submitbutton.value = 'dcGOR R ';
			}
		});
	}
}
</script>

<script>
  (function() {
    var cx = '012094530736424854714:k8ieyz4ag4a';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

<div><gcse:search></gcse:search></div>

    <div class="container">
      <header>
        
      </header>
      
      <h2>Function to reconstruct ancestral discrete states using fast maximum likelihood algorithm</h2>

<div class="row">
  <div class="span8">
  
    <h3>Description</h3>
    <p><code>dcAncestralML</code> is supposed to reconstruct ancestral discrete
states using fast maximum likelihood algorithm. It takes inputs both
the phylo-formatted tree and discrete states in the tips. The algorithm
assumes that state changes can be described by a probablistic
reversible model. It first determines transition matrix between states
(also considering branch lengths), then uses dynamic programming (from
tips to the root) to estimate conditional maximum likelihood, and
finally reconstructs the ancestral states (from the root to tips). If
the ties occur at the root, the state at the root is set to the last
state in ties (for example, usually being 'present' for
'present'-'absent' two states).</p>
  
    <h3>Usage</h3>
    <pre>dcAncestralML(data, phy, transition.model = c("different", "symmetric", "same", "customised"), 
  customised.model = NULL, edge.length.power = 1, initial.estimate = 0.1, output.detail = F, 
      parallel = T, multicores = NULL, verbose = F)</pre>
    
    <h3>Arguments</h3>
    <dl>
      <dt>data</dt>
      <dd>an input data matrix storing discrete states for tips (in
rows) X characters (in columns). The rows in the matrix are for tips.
If the row names do not exist, then addumedly they have the same order
as in the tree tips. More wisely, users provide row names which can be
matched to the tip labels of the tree. The row names can be more than
found in the tree labels, and they should contain all those in the tree
labels</dd>
      <dt>phy</dt>
      <dd>an object of class 'phylo'</dd>
      <dt>transition.model</dt>
      <dd>a character specifying the transition model. It
can be: "different" for all-transition-different model (such as
<code class = 'eq'>matrix(c(0,1,2,0),2)</code>), "symmetric" for the symmetric model (such
as <code class = 'eq'>matrix(c(0,1,1,0),2)</code> or <code class = 'eq'>matrix(c(0,1,2,1,0,3,2,3,0),3)</code>),
"same" for all-transition-same model (such as
<code class = 'eq'>matrix(c(0,1,1,0),2)</code>), "customised" for the user-customised model
(see the next parameter)</dd>
      <dt>customised.model</dt>
      <dd>a matrix customised for the transition model.
It can be: <code class = 'eq'>matrix(c(0,1,1,0),2)</code>, <code class = 'eq'>matrix(c(0,1,2,0),2)</code>, or
<code class = 'eq'>matrix(c(0,1,2,1,0,3,2,3,0),3)</code></dd>
      <dt>edge.length.power</dt>
      <dd>a non-negative value giving the exponent
transformation of the branch lengths. It is useful when determining
transition matrix between states</dd>
      <dt>initial.estimate</dt>
      <dd>the initial value used for the maximum
likelihood estimation</dd>
      <dt>output.detail</dt>
      <dd>logical to indicate whether the output is returned
as a detailed list. If TRUE, a nested list is returned: a list of
characters (corresponding to columns of input data matrix), in which
each element is a list consisting of three components ("states",
"transition" and "relative"). If FALSE, a matrix is returned: the
columns respond to the input data columns, and rows responding to all
node index in the phylo-formatted tree</dd>
      <dt>parallel</dt>
      <dd>logical to indicate whether parallel computation with
multicores is used. By default, it sets to true, but not necessarily
does so. Partly because parallel backends available will be
system-specific (now only Linux or Mac OS). Also, it will depend on
whether these two packages "foreach" and "doMC" have been installed. It
can be installed via:
<code>source("http://bioconductor.org/biocLite.R");
biocLite(c("foreach","doMC"))</code>. If not yet installed, this option will
be disabled</dd>
      <dt>multicores</dt>
      <dd>an integer to specify how many cores will be
registered as the multicore parallel backend to the 'foreach' package.
If NULL, it will use a half of cores available in a user's computer.
This option only works when parallel computation is enabled</dd>
      <dt>verbose</dt>
      <dd>logical to indicate whether the messages will be
displayed in the screen. By default, it sets to TRUE for display</dd>
    </dl>
    <!-- 
    -->
    
    <!-- 
    <div class="Value">
    -->
      <h3>Value</h3>
      
      <p>It depends on the 'output.detail'.
If FALSE (by default), a matrix is returned, with the columns
responding to the input data columns, and rows responding to node index
in the phylo-formatted tree.
If TRUE, a nested list is returned. Outer-most list is for characters
(corresponding to columns of input data matrix), in which each elemenl
is a list (inner-most) consisting of three components ("states",
"transition" and "relative"):
<ul>
<li><code>states</code>: a named vector storing states (extant and
ancestral states)
</li>
<li><code>transition</code>: an estimated transition matrix between states
</li>
<li><code>relative</code>: a matrix of nodes X states, storing conditional
maximum likelihood being relative to each state
</li>
</ul></p>
      <p></p>
    <!-- 
    </div>
    -->
    <!-- 
    <div class="Note">
    -->
      <h3>Note</h3>
      
      <p>This fast dynamic programming for ancestral discrete state
reconstruction is partially inspired by a joint estimation procedure as
described in <a href = 'http://mbe.oxfordjournals.org/content/17/6/890.full'>http://mbe.oxfordjournals.org/content/17/6/890.full</a></p>
    <!-- 
    </div>
    -->
    
    <h3 id="examples">Examples</h3>
    <pre class="examples"><div class='input'># 1) provide the phylo-formatted tree
tree <-
"((((t10:5,t2:5):2,(t9:4,t5:4):3):2,(t3:4,t7:4):6):2,((t6:4,t1:4):2,(t8:2,t4:2):4):6);"
phy <- ape::read.tree(text=paste(tree, collapse=""))

# 2) an input data matrix storing discrete states for tips (in rows) X two characters (in columns)
data1 <- matrix(c(0,rep(1,4),rep(0,5)), ncol=1)
data2 <- matrix(c(0,rep(0,4),rep(1,5)), ncol=1)
data <- cbind(data1, data2)
colnames(data) <- c("C1", "C2")
## reconstruct ancestral states, without detailed output
res <- dcAncestralML(data, phy, parallel=FALSE)
res
</div>
<div class='output'>   C1  C2 
1  "0" "0"
2  "1" "0"
3  "1" "0"
4  "1" "0"
5  "1" "0"
6  "0" "1"
7  "0" "1"
8  "0" "1"
9  "0" "1"
10 "0" "1"
11 "1" "0"
12 "1" "0"
13 "1" "0"
14 "1" "0"
15 "1" "0"
16 "1" "0"
17 "0" "1"
18 "0" "1"
19 "0" "1"
</div>
<div class='input'>
# 3) an input data matrix storing discrete states for tips (in rows) X only one character
data <- matrix(c(0,rep(0,4),rep(1,5)), ncol=1)
## reconstruct ancestral states, with detailed output
res <- dcAncestralML(data, phy, parallel=FALSE, output.detail=TRUE,
verbose=TRUE)
</div>
<strong class='message'>The input tree has '10' tips.</strong>
<strong class='message'>1 out of 1 (2014-10-24 20:09:56)</strong>
<strong class='message'>First, estimate the transition matrix based on the 'different' model and initial estimate '0.10' (2014-10-24 20:09:56) ...</strong>
<strong class='message'>Second, estimate conditional maximum likelihood in a bottom-up manner (2014-10-24 20:09:56) ...</strong>
<strong class='message'>Finally, reconstruct ancestral states in a top-down manner (2014-10-24 20:09:56) ...</strong>
<strong class='message'>In summary, the number of between-state changes:
0->1: 2
1->1: 6
0->0: 10</strong>
<div class='input'>res
</div>
<div class='output'>[[1]]
[[1]]$states
  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19 
"0" "0" "0" "0" "0" "1" "1" "1" "1" "1" "0" "0" "0" "0" "0" "0" "1" "1" "1" 

[[1]]$transition
       0       1
0 0.9508 0.04922
1 0.0000 1.00000

[[1]]$relative
         0      1
1  1.00000 0.0000
2  1.00000 0.0000
3  1.00000 0.0000
4  1.00000 0.0000
5  1.00000 0.0000
6  0.04691 0.9531
7  0.04691 0.9531
8  0.04691 0.9531
9  0.04691 0.9531
10 0.04691 0.9531
11 1.00000 0.0000
12 1.00000 0.0000
13 1.00000 0.0000
14 1.00000 0.0000
15 1.00000 0.0000
16 1.00000 0.0000
17 0.04691 0.9531
18 0.04691 0.9531
19 0.04691 0.9531


</div>
<div class='input'>## get the inner-most list
res <- res[[1]]
## visualise the tree with ancestral states and their conditional probability
Ntip <- ape::Ntip(phy)
Nnode <- ape::Nnode(phy)
color <- c("white","gray")
## visualise main tree
ape::plot.phylo(phy, type="p", use.edge.length=TRUE, label.offset=1,
show.tip.label=TRUE, show.node.label=FALSE)
</div>
<a href="javascript:newWin('dcAncestralML-13.png', 'dcAncestralML-13.png', '1200', '1200')" title="Click to enlarge"><img style="max-width:95%;border:1px solid #EEEEEE;box-shadow:5px 5px 2px #C0C0C0;" src='dcAncestralML-13.png', width="400" /></a>
<div class='input'>## visualise tips (state 1 in gray, state 0 in white)
x <- data[,1]
ape::tiplabels(pch=22, bg=color[as.numeric(x)+1], cex=2, adj=1)
</div>
<a href="javascript:newWin('dcAncestralML-15.png', 'dcAncestralML-15.png', '1200', '1200')" title="Click to enlarge"><img style="max-width:95%;border:1px solid #EEEEEE;box-shadow:5px 5px 2px #C0C0C0;" src='dcAncestralML-15.png', width="400" /></a>
<div class='input'>## visualise internal nodes
### thermo bar to illustrate relative probability (state 1 in gray, state 0 in white)
ape::nodelabels(thermo=res$relative[Ntip+1:Nnode,2:1],
piecol=color[2:1], cex=0.75)
</div>
<a href="javascript:newWin('dcAncestralML-17.png', 'dcAncestralML-17.png', '1200', '1200')" title="Click to enlarge"><img style="max-width:95%;border:1px solid #EEEEEE;box-shadow:5px 5px 2px #C0C0C0;" src='dcAncestralML-17.png', width="400" /></a>
<div class='input'>### labeling reconstructed ancestral states
ape::nodelabels(text=res$states[Ntip+1:Nnode], node=Ntip+1:Nnode,
frame="none", col="red", bg="transparent", cex=0.75)
</div>
<a href="javascript:newWin('dcAncestralML-19.png', 'dcAncestralML-19.png', '1200', '1200')" title="Click to enlarge"><img style="max-width:95%;border:1px solid #EEEEEE;box-shadow:5px 5px 2px #C0C0C0;" src='dcAncestralML-19.png', width="400" /></a></pre>
  </div>
  
  <div class="span4">
    
    <!-- 
    <ul>
      <li>dcAncestralML</li>
    </ul>
    <ul>
      
    </ul> 
    -->
    
    <h2>Source code</h2>
    <a href="javascript:newWin('R/dcAncestralML.r', 'R/dcAncestralML.r', '1200', '1200')" title="Click to view"><B><code>dcAncestralML.r</code></B></a>
    
    <h2>Source man</h2>
    <a href="javascript:newWin('man/dcAncestralML.txt', 'man/dcAncestralML.txt', '1200', '1200')" title="Click to view"><B><code>dcAncestralML.Rd</code></B></a>
    
    <a href="javascript:newWin('man/dcAncestralML.pdf', 'man/dcAncestralML.pdf', '1200', '1200')" title="Click to view"><B><code>dcAncestralML.pdf</code></B></a>
    
    <h2>See also</h2>
    
<code><a href='dcAncestralMP.html'>dcAncestralMP</a></code>

    <!--

    <h2>Citation</h2>
    <p>Fang H. (2014) <B>dcGOR: an R package for analysing ontologies and protein domain annotations</B>. <I>PLoS Computational Biology</I> (<a href="http://dx.doi.org/10.1371/journal.pcbi.1003929">doi:10.1371/journal.pcbi.1003929</a>)</p>

<p>You may also cite the package as:</p>

<ul>
<li><code>database</code></li>
</ul>

<p>Fang H, Gough J. (2013) dcGO: database of domain-centric ontologies on functions, phenotypes, diseases and more. <I>Nucleic Acids Research</I> 41(Database issue):D536-44 (<a href="http://dx.doi.org/10.1093/nar/gks1080">doi:10.1093/nar/gks1080</a>)</p>

<ul>
<li><code>web link/URL</code></li>
</ul>

<p>Package &ldquo;dcGOR&rdquo; [<a href="http://cran.r-project.org/package=dcGOR">http://cran.r-project.org/package=dcGOR</a>]</p>

    
    
    <h2>URL</h2>
    <ul>
      <li><a href="http://supfam.org/dcGOR">http://supfam.org/dcGOR</a></li>
    </ul>
    
    
    -->
    
  </div>
  
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>

<p><a href="mailto:hfang@cs.bris.ac.uk" title="Hai Fang">Hai Fang</a></p>
<p><a href="http://bioinformatics.bris.ac.uk">Computational Genomics Group, Department of Computer Science, University of Bristol, UK</a></p>


      </footer>
    </div>
  </body>
</html>